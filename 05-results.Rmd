# Results

```{r eval = FALSE, echo=FALSE}
library(plotly)
library(tidyverse)
library(lubridate)
library(patchwork)
sample_data=read.csv('sample_data.csv')
```

## Overview of dataset

In China, people might prefer to add something to cart just because they like it at that moment, but this does not necessarily mean they will buy it in a few hours. So we decide to interpret `fav` and `cart` as the same type of behavior and call it `fav&cart`.

We first draw a funnel chart to see the percentage of different kinds of User Behaviors. As we can see in Fig 1, clicking behavior has taken most of the part, and buying only takes 2% of the total behaviors, which is a baseline and we will talk about it later. It might come to our mind that this distribution shall be rather stationary, which means users click similar times everyday, and the conversion rate for them to turn their clicking into buying this staff shall be the same.

```{r eval = FALSE, echo=FALSE}
sample_data[sample_data$Behavior_type %in% c('fav','cart'),'Behavior_type']='fav&cart'
behavior_count = sort(table(sample_data[,"Behavior_type"]),decreasing = TRUE)

fig <- plot_ly(
  type = "funnelarea",
  text = names(behavior_count),
  values = behavior_count,
  title='Fig1:Funnel Chart of fraction bewteen different behavior')

fig
```

```{r}
sample_data <- sample_data %>% mutate(Hour=hour(Time),Date = date(Time))
hour_sum <- sample_data %>% group_by(Hour,Behavior_type) %>% count %>% pivot_wider(names_from = Behavior_type,values_from = n)
Date_sum <- sample_data %>% group_by(Date,Behavior_type) %>% count %>% pivot_wider(names_from = Behavior_type,values_from = n)
```

## Analysis by Hours

So we tried to draw a distribution of clicking and buying behavior in a day. In Fig 2, it is not surprising for us to see that the clicking behavior is rather stationary during the day time from 10am to 6pm. However, the clicking behaviors gradually increase by 80% between 6pm and 9pm. It clearly shows that Chinese online shopping users would like to go through the online stores as a recreation after work.

The thing becomes even more interesting if we look at Fig 3. We make a graph using the amount of buying behaviors divide by the amount of clicking behaviors. In the funnel chart, the average ratio of buy/pv is about 2.2% in total.However, if we try to look at this ratio deeper, it seems that after 6pm, when people start to click on the app in high frequency, it seems that their clicking behavior cannot turning into buying behavior at the same scale. This also proves that people might regard searching and merely looking online merchandise as recreation.

```{r}
# difference between click and buy
fig2<-ggplot(hour_sum,aes(x=Hour, y=pv))+
  geom_line()+
  ggtitle('Fig2: Trend of Clicking behavior in a day')

temp<-hour_sum %>% mutate(ratio_pv_buy=buy/pv)
fig3<-ggplot(temp,aes(x=Hour))+
  geom_line(aes(y=ratio_pv_buy))+
  geom_hline(yintercept = sum(hour_sum$buy)/sum(hour_sum$pv),color='red')+
  ylab('ratio')+
  ggtitle('Fig3: Trend of Buy/Click behavior in a day')
fig2+fig3
```
## Analysis by days

```{r}
fig4<-ggplot(Date_sum, aes(Date, pv)) +  
    geom_label(aes(label = wday(Date, label = TRUE))) +  
    geom_line(color = "cornflowerblue") +   
    scale_x_date(date_labels = "%b\n%d",  
                 date_breaks = "1 day")+
  ggtitle('Fig4: Trend of Clicking behavior bewteen days')


fig5<-ggplot(Date_sum, aes(Date, buy)) +  
    geom_label(aes(label = wday(Date, label = TRUE))) +  
    geom_line(color = "cornflowerblue") +   
    scale_x_date(date_labels = "%b\n%d",  
                 date_breaks = "1 day")+
  ggtitle('Fig5: Trend of Buying behavior bewteen days')
fig4+fig5
```
The first line graph shows the total number of user clicking behaviors. As we can clearly see in the graph, on November 25, November 26, the user clicking activity is relatively higher, but starting from Monday, the number of user clicking behavior strictly decreases. More surprisingly, on December 2, the total number of user behavior rocketed by about 20% compared to that of Friday, and on Sunday December 3, the user activity stays high. We made two oberservation about the user behavior:

1. The user clicking behaviors tended to be high on weekend and low on weekdays. This is understandable since people might not have free time browing the website while working.

2. The user clicking behaviors stayed relatively constant during the weekday. 

3. The user clicking behaviors suprisingly rocketed on December 2. Our conjecture is that the increase is due to the famous double-12 shopping festival created by Alibaba, which officially starts on December 12 each year when Alibaba offers discounts and promotions for most of the products online.

## Analysis by Item Category

Another question is that: does conversion rate keep constant between popular items and the others? Or, does people are more likely to buy the stuff which they click a lot? To do this, first we find out there are 4186 kind of items are bought. We divide them into 5 groups according to their clicking times, and calculate their conversion = buy/clicking. Here we get Fig 6 below:

```{r}
tmp<-filter(sample_data,Behavior_type=='pv')
frequence_categories = names(sort(table(tmp$Category_ID),decreasing=TRUE))
sorting_conversion <- function(gap,class){
  conversion_Categories = rep(0,class)
  for(i in c(1:class)){
    s = 1+gap*(i-1)
    t =  gap*i
    categories = frequence_categories[s:t]
    freq_data = sample_data %>% filter(Category_ID %in% categories)
    pv = sum(freq_data$Behavior_type=='pv')
    buy = sum(freq_data$Behavior_type=='buy')
    conversion_Categories[i] = buy/pv
  }
  names = sprintf("group[%s]",seq(1:class))
  conversion_Categories <- data_frame(names=names,value=conversion_Categories)
  return(ggplot(conversion_Categories,aes(x=names,y=value))+
    geom_bar(stat = "identity", width = .75, fill = "#0073C2FF")+xlab('Groups')+ylab('Conversion Rate'))
}

fig6<-sorting_conversion(800,5)
fig6
```
As we can see in the graph above, the higher the clicking rate a product category has, the lower its conversion rate is. In another word, those product that were viewed most frequenly are less likely to be bought by the user. We made three conjecture about this behavior:

1. This can be due to the fact that the product with the highest clicking rate are the ones that are commonly recommended by the recommender system. People might be interested in clicking the product but they might already have an ideal product in their mind. Therefore, they are less likely to buy them. 

2. Those product are the ones that catches people's attention but are too costly. For example, people like to click on luxury products such as gaming laptops or designer clothing, but are unlikely to buy them due to the high price. 

3. This can also be due to malicious user behavior, such as click-farming. This is a common problem for US online shopping platform such as Ebay and Amazon, where users are paid to click or buy a product to increase its popularity in the recommender system.

## Analysis the relationship bewteen fav&cart and buy

Here we are trying to analysis how buying behavior is affected by fav&cart behavior. Since our trading data is cut from the whole time flow, it's possible that someone fav&cart an item before the start time of our data and buy it during the 9 days(in our data time span), or vice versa. So here we just focus on existing fav&cart-buy pair and see its pattern.

To do this, we filter out those items one customer fav&cart and buy, and calculate difference of time for these two behaviors. In fact, there is a small portion of data which is negative (only 5.4%, 23654 sample size in total), which is rather logical and prove the feasibility of our analysis. We will ignore the negative values and plot the time diff bar plot:

```{r}
tmp <- filter(sample_data,Behavior_type!='pv') %>% mutate(User_Item=paste(as.character(User_ID),as.character(Item_ID),sep='_'))

pair <- tmp %>% select(c(User_ID,Item_ID,Behavior_type)) %>% distinct() %>% group_by(User_ID,Item_ID) %>% summarise(count=n(),.groups = 'drop') %>% filter(count>1) %>% mutate(User_Item=paste(as.character(User_ID),as.character(Item_ID),sep='_'))

tmp <- filter(tmp,User_Item%in%pair$User_Item) %>%distinct(Behavior_type,User_Item,.keep_all = TRUE)

tmp_buy <- tmp%>% filter(Behavior_type=='buy')
tmp_fc <- tmp%>% filter(Behavior_type=='fav&cart')
tmp_buy <- tmp_buy[order(tmp_buy$User_Category),]
tmp_fc <- tmp_fc[order(tmp_fc$User_Category),]

time_diff = round(difftime(tmp_buy$Time,tmp_fc$Time,units = "days"))
time_diff = table(time_diff[time_diff>=0])
time_diff <-data.frame(names=names(time_diff),value=as.numeric(time_diff))
fig7<-ggplot(time_diff, aes(x=names,y=value)) +
  geom_bar(stat='identity',fill = "#0073C2FF")+
  xlab("Days")+
  ylab('Amount')+
  ggtitle('Time diff bewteen buy and fav&cart behaviors(days)')
fig7
```

From the graph, it is obvious that most people tend to pay for their noted items in 2 days(about 75%),and the possibility is strictly decreasing. Surely, this is due to our limited time span, those trade in long time span are more likely to not be recorded in data. However, this provide us a good way to think about: when you fav&cart a item, what is the likelihood that you will buy it? What's more, what's the minor difference between fav and cart? We may explore it from the time diff and the likelihood to pay for different behaviors.

## Analysis of outlier

We highly suspect that the most frequent user are click-farming. However, they could just be extremely enthusiastic about onlinen shopping. To find out which hypothesis is correct, we first retrieve the number of activities that each single user performs and plot them in a box plot. Figure 8 diaplays the boxplot displaying the number of user activities over the 9 days:

```{r}
boxplot_data <- sample_data %>%
  group_by(User_ID) %>%
  summarise(freq = n()) %>%
  arrange(desc(freq))

fig8 <- ggplot(boxplot_data) +
  ggtitle("Fig8: distribution of the number of 9-day aggregate activities") +
  geom_boxplot(aes(x=freq), outlier.color="red") +
  xlab("Number of user activities") +
  geom_vline(aes(xintercept = median(freq)), color = "blue")
  
fig8
```

We colored all the outliers in red in the graph above. The boxplot further made us suepect those with extremely high activity level are abnormal users, since they clustered around a very high level of number of activities. As we can see in the graph, the interquartile represents the number of normal user activities which range from approximately 50 to 150 over the 9 day period. On the other hand, the extreme outliers can carry out almost 800 activities, this is about 5 times more than the most actival normal users. Therefore, we highly suspect that the users at the very right side of the boxplot are click-farming. Therefore, in order to further confirm this, we further analyze the most frequent user's behavior. 

In Figure 8, we selected the most frequent user who carries out about 800 activities over the 9 day period. We look at the total number activities they made:

```{r}
most_freq <- boxplot_data %>% slice(1)
most_freq <- most_freq$User_ID
most_freq

item_freq <- sample_data %>% filter(User_ID==most_freq) %>%
  group_by(Item_ID) %>%
  summarise(freq = n()) %>%
  group_by(freq) %>%
  summarise(count=n())

item_freq
fig9 <- ggplot(item_freq,aes(x=freq, y=count)) +
  geom_bar(stat = "identity", width = .75, fill = "lightblue") +
  ggtitle("Fig9: the frequency of the product ") +
  xlab("the number of activities on a single product") +
  ylab("frequency of the case happening")

fig9
```

Unluckily, we are unable to confirm our conjecture that the active user is malicious ones just from the figure above. If the user is a malicious one, it should spend excessively large amout of activities on a few targeted single product. However, their behavior is sparsely scattered into different products. He or she could just simply be addictive to viewing various products.
